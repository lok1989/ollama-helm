────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
1. Staging Collection + $merge        | 2. InventoryProcessorMongoDB         | 3. Bulk Upsert + Cleanup (Final Form)
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
           ▼                          |           ▼                          |           ▼
   [ Incoming Feed ]                |   [ Incoming Feed ]                |   [ Incoming Feed ]
           │                          |           │                          |           │
           ▼                          |           ▼                          |   Split into 40K-sized batches
 Insert into stage_product          | Insert into new_records            |           │
     (insertMany)                   |     (insertMany)                   |           ▼
           │                          |           │                          | For each batch:
           ▼                          |           ▼                          |   → Construct bulk `UpdateOneModel`s
   $merge into product              | Compare with previous_records      |   → `bulkWrite(upsert = true)` on product
   on upc, country, storeNumber     | using ID matching                  |           │
           │                          |           │                          ▼
           ▼                          |           ▼                     All records written to `product`
 Update availableQty where          | ┌────────────┐   ┌────────────┐       |
 skxUpdatedDate < batch timestamp   | │ updateExisting │ │ insertNew │       |
           ▼                        | └──────┬───────┘   └──────┬─────┘       ▼
                                    |        ▼                 ▼        Final cleanup:
                                    |  processed_records (final view)  updateMany() → availableQty = 0
                                                                         where skxUpdatedDate < batch time
